---
name: Deploy static site
on:
  workflow_dispatch:
  push:
    branches:
      - main
  # on PRs while debugging
  pull_request:
jobs:
  build:
    name: Render and deploy protocol and API docs
    steps:
      - name: Checkout the source code
        uses: actions/checkout@v2

      - name: Install Rust toolchain
        uses: actions-rs/toolchain@v1
        with:
          profile: minimal
          toolchain: stable
          override: true

      - name: Load Rust caching
        uses: Swatinem/rust-cache@v1

      - name: Build static site
        run: ./build-static-site

      - name: Deploy dapp static site to firebase
        uses: w9jds/firebase-action@v2.0.0
        with:
          args: deploy
        env:
          FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}
          PROJECT_ID: penumbra-dapp
          PROJECT_PATH: docroot
